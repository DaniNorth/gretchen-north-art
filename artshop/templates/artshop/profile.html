{% extends "base.html" %}
{% block title %}My Profile{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto mt-10 p-6 bg-container-background rounded-xl shadow-md">
  <h1 class="text-3xl font-bold text-heading-text mb-4">
    Welcome, {{ profile.full_name|default:user.username }}
  </h1>

  <div class="mb-6">
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-xl font-semibold text-subheading">Profile Info</h2>
      <a href="{% url 'edit_profile' %}" class="text-link hover:text-link-hover text-sm">Edit Profile</a>
    </div>
    <button
      type="button"
      id="toggle-profile-btn"
      onclick="toggleProfile()"
      class="text-sm text-link hover:text-link-hover mb-2"
    >
      Show Account Info
    </button>
    <div
      id="profile-info"
      class="overflow-hidden max-h-0 transition-all duration-500 ease-in-out"
    >
      <div class="grid grid-cols-2 gap-4 text-paragraph-text pt-4">
        <p><strong>Full Name:</strong> {{ profile.full_name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Phone:</strong> {{ profile.phone }}</p>
        <p><strong>Address:</strong> {{ profile.address }}</p>
        <p><strong>City:</strong> {{ profile.city }}</p>
        <p><strong>State:</strong> {{ profile.state }}</p>
        <p><strong>ZIP:</strong> {{ profile.postal_code }}</p>
        <p><strong>Country:</strong> {{ profile.country }}</p>
      </div>
    </div>
  </div>
  <hr class="my-8 border-color">

  <div class="mb-8">
    <h2 class="text-xl font-semibold text-subheading mb-2">Cart Preview</h2>
    {% if cart.items.all %}
      <ul class="list-disc ml-5">
        {% for item in cart.items.all %}
          <li>{{ item.artwork.title }} - ${{ item.artwork.price }}</li>
        {% endfor %}
      </ul>
      <div class="mt-4 flex space-x-3">
        <a href="{% url 'cart' %}" class="bg-button hover:bg-button-hover text-white font-semibold py-2 px-4 rounded text-sm">
          Go to Cart
        </a>
        <a href="{% url 'home' %}" class="bg-secondary-button hover:bg-button-hover text-white font-semibold py-2 px-4 rounded text-sm">
          Browse More Art
        </a>
      </div>
    {% else %}
      <p>Your cart is empty.</p>
      <a href="{% url 'home' %}" class="mt-2 inline-block bg-button hover:bg-button-hover text-white font-semibold py-2 px-4 rounded text-sm">
        Browse Art
      </a>
    {% endif %}
  </div>


  <div class="mb-8">
    <div class="flex justify-between items-center">
      <h2 class="text-xl font-semibold text-subheading mb-2">Wishlists</h2>
      <a href="#" onclick="openWishlistModal()" class="text-sm bg-button hover:bg-button-hover text-white font-semibold py-1 px-3 rounded">
        + New Wishlist
      </a>
    </div>
    {% for wishlist in wishlists %}
      <div class="mb-4 p-4 border border-color rounded">
        <h3 class="font-bold text-heading-text">{{ wishlist.title }}</h3>
        <ul class="list-disc ml-5 text-paragraph-text">
          {% for item in wishlist.items.all %}
            <li class="flex justify-between items-center">
              <span>{{ item.artwork.title }}</span>
              <form method="post" action="{% url 'remove_from_wishlist' wishlist.pk item.artwork.pk %}" onsubmit="return confirm('Remove this artwork?');">
                {% csrf_token %}
                <button type="submit" class="text-red-600 hover:underline text-xs">Remove</button>
              </form>
            </li>
          {% empty %}
            <li>No items yet.</li>
          {% endfor %}
        </ul>
        <div class="mt-2 space-x-2 text-sm">
          <a href="{% url 'wishlist_detail' wishlist.pk %}" class="text-link hover:text-link-hover">View</a>
          <a href="{% url 'edit_wishlist' wishlist.pk %}" class="text-link hover:text-link-hover">Edit</a>
        </div>
        <form action="{% url 'delete_wishlist' wishlist.pk %}" method="post" class="inline-block" onsubmit="return confirm('Are you sure you want to delete this wishlist?');">
          {% csrf_token %}
          <button type="submit" class="text-red-600 hover:underline text-sm">Delete</button>
        </form>
      </div>
    {% empty %}
      <p>You donâ€™t have any wishlists yet.</p>
    {% endfor %}
  </div>
</div>

<script>
function toggleProfile() {
  const info = document.getElementById('profile-info');
  const button = document.getElementById('toggle-profile-btn');

  const isCollapsed = info.classList.contains('max-h-0');

  if (isCollapsed) {
    info.classList.remove('max-h-0');
    info.classList.add('max-h-[1000px]');
    button.textContent = 'Hide Account Info';
  } else {
    info.classList.remove('max-h-[1000px]');
    info.classList.add('max-h-0');
    button.textContent = 'Show Account Info';
  }
}
</script>

<script>
  function openWishlistModal() {
    fetch("{% url 'create_wishlist' %}")
      .then(response => response.text())
      .then(html => openModal(html));
  }
</script>
{% endblock %}